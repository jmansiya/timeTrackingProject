define(["durandal/system","durandal/binder","knockout"],function(e,t,n){function i(e){var t=e[0];return"_"===t||"$"===t||S&&e===S}function o(t){return!(!t||void 0===t.nodeType||!e.isNumber(t.nodeType))}function a(e){if(!e||o(e)||e.ko===n||e.jquery)return!1;var t=h.call(e);return-1==g.indexOf(t)&&!(e===!0||e===!1)}function r(e){var t={};return Object.defineProperty(e,"__observable__",{enumerable:!1,configurable:!1,writable:!1,value:t}),t}function s(e,t,n){var i=e.__observable__,o=!0;if(!i||!i.__full__){i=i||r(e),i.__full__=!0,y.forEach(function(n){t[n]=function(){return w[n].apply(e,arguments)}}),p.forEach(function(n){e[n]=function(){o=!1;var e=k[n].apply(t,arguments);return o=!0,e}}),m.forEach(function(n){e[n]=function(){o&&t.valueWillMutate();var i=w[n].apply(e,arguments);return o&&t.valueHasMutated(),i}}),b.forEach(function(i){e[i]=function(){for(var a=0,r=arguments.length;r>a;a++)c(arguments[a],n);o&&t.valueWillMutate();var s=w[i].apply(e,arguments);return o&&t.valueHasMutated(),s}}),e.splice=function(){for(var i=2,a=arguments.length;a>i;i++)c(arguments[i],n);o&&t.valueWillMutate();var r=w.splice.apply(e,arguments);return o&&t.valueHasMutated(),r};for(var a=0,s=e.length;s>a;a++)c(e[a],n)}}function c(t,i){var o,c;if(S&&t&&t[S]&&(i=i?i.slice(0):[],i.push(t[S])),a(t)&&(o=t.__observable__,!o||!o.__full__)){if(o=o||r(t),o.__full__=!0,e.isArray(t)){var l=n.observableArray(t);s(t,l,i)}else for(var f in t)if(!v(f)&&!o[f]){var h=Object.getPropertyDescriptor(t,f);h&&(h.get||h.set)?d(t,f,{get:h.get,set:h.set}):(c=t[f],e.isFunction(c)||u(t,f,c,i))}A&&e.log("Converted",t)}}function l(e,t,n){n?t?t.destroyAll||s(t,e):(t=[],s(t,e)):c(t),e(t)}function u(t,i,o,a){var u,d,f=t.__observable__||r(t);if(void 0===o&&(o=t[i]),e.isArray(o))u=n.observableArray(o),s(o,u,a),d=!0;else if("function"==typeof o){if(!n.isObservable(o))return null;u=o}else!x&&e.isPromise(o)?(u=n.observable(),o.then(function(t){if(e.isArray(t)){var i=n.observableArray(t);s(t,i,a),t=i}u(t)})):(u=n.observable(o),c(o,a));return a&&a.length>0&&a.forEach(function(n){e.isArray(o)?u.subscribe(function(e){n(t,i,null,e)},null,"arrayChange"):u.subscribe(function(e){n(t,i,e,null)})}),Object.defineProperty(t,i,{configurable:!0,enumerable:!0,get:u,set:n.isWriteableObservable(u)?function(t){t&&e.isPromise(t)&&!x?t.then(function(t){l(u,t,e.isArray(t))}):l(u,t,d)}:void 0}),f[i]=u,u}function d(t,i,o){var a,r={owner:t,deferEvaluation:!0};return"function"==typeof o?r.read=o:("value"in o&&e.error('For defineProperty, you must not specify a "value" for the property. You must provide a "get" function.'),"function"!=typeof o.get&&"function"!=typeof o.read&&e.error('For defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".'),r.read=o.get||o.read,r.write=o.set||o.write),a=n.computed(r),t[i]=a,u(t,i,a)}var f,v,h=Object.prototype.toString,g=["[object Function]","[object String]","[object Boolean]","[object Number]","[object Date]","[object RegExp]"],p=["remove","removeAll","destroy","destroyAll","replace"],m=["pop","reverse","sort","shift","slice"],b=["push","unshift"],y=["filter","map","reduce","reduceRight","forEach","every","some"],w=Array.prototype,k=n.observableArray.fn,A=!1,S=void 0,x=!1;if(!("getPropertyDescriptor"in Object)){var D=Object.getOwnPropertyDescriptor,R=Object.getPrototypeOf;Object.getPropertyDescriptor=function(e,t){for(var n,i=e;i&&!(n=D(i,t));)i=R(i);return n}}return f=function(e,t){var i,o,a;return e?(i=e.__observable__,i&&(o=i[t])?o:(a=e[t],n.isObservable(a)?a:u(e,t,a))):null},f.defineProperty=d,f.convertProperty=u,f.convertObject=c,f.install=function(e){var n=t.binding;t.binding=function(e,t,i){i.applyBindings&&!i.skipConversion&&c(e),n(e,t)},A=e.logConversion,e.changeDetection&&(S=e.changeDetection),x=e.skipPromises,v=e.shouldIgnorePropertyName||i},f});