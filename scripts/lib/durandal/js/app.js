define(["durandal/system","durandal/viewEngine","durandal/composition","durandal/events","jquery"],function(e,t,n,i,o){function a(){return e.defer(function(t){return 0==s.length?(t.resolve(),void 0):(e.acquire(s).then(function(n){for(var i=0;i<n.length;i++){var o=n[i];if(o.install){var a=c[i];e.isObject(a)||(a={}),o.install(a),e.log("Plugin:Installed "+s[i])}else e.log("Plugin:Loaded "+s[i])}t.resolve()}).fail(function(t){e.error("Failed to load plugin(s). Details: "+t.message)}),void 0)}).promise()}var r,s=[],c=[];return r={title:"Application",configurePlugins:function(t,n){var i=e.keys(t);n=n||"plugins/",-1===n.indexOf("/",n.length-1)&&(n+="/");for(var o=0;o<i.length;o++){var a=i[o];s.push(n+a),c.push(t[a])}},start:function(){return e.log("Application:Starting"),this.title&&(document.title=this.title),e.defer(function(t){o(function(){a().then(function(){t.resolve(),e.log("Application:Started")})})}).promise()},setRoot:function(i,o,a){function r(){if(c.model)if(c.model.canActivate)try{var t=c.model.canActivate();t&&t.then?t.then(function(e){e&&n.compose(s,c)}).fail(function(t){e.error(t)}):t&&n.compose(s,c)}catch(i){e.error(i)}else n.compose(s,c);else n.compose(s,c)}var s,c={activate:!0,transition:o};s=!a||e.isString(a)?document.getElementById(a||"applicationHost"):a,e.isString(i)?t.isViewUrl(i)?c.view=i:c.model=i:c.model=i,e.isString(c.model)?e.acquire(c.model).then(function(t){c.model=e.resolveObject(t),r()}).fail(function(t){e.error("Failed to load root module ("+c.model+"). Details: "+t.message)}):r()}},i.includeIn(r),r});