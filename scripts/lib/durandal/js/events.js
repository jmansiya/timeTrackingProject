define(["durandal/system"],function(e){var t=/\s+/,i=function(){},n=function(e,t){this.owner=e,this.events=t};return n.prototype.then=function(e,t){return this.callback=e||this.callback,this.context=t||this.context,this.callback?(this.owner.on(this.events,this.callback,this.context),this):this},n.prototype.on=n.prototype.then,n.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},i.prototype.on=function(e,i,o){var a,r,s;if(i){for(a=this.callbacks||(this.callbacks={}),e=e.split(t);r=e.shift();)s=a[r]||(a[r]=[]),s.push(i,o);return this}return new n(this,e)},i.prototype.off=function(i,n,o){var a,r,s,c;if(!(r=this.callbacks))return this;if(!(i||n||o))return delete this.callbacks,this;for(i=i?i.split(t):e.keys(r);a=i.shift();)if((s=r[a])&&(n||o))for(c=s.length-2;c>=0;c-=2)n&&s[c]!==n||o&&s[c+1]!==o||s.splice(c,2);else delete r[a];return this},i.prototype.trigger=function(e){var i,n,o,a,r,s,c,l;if(!(n=this.callbacks))return this;for(l=[],e=e.split(t),a=1,r=arguments.length;r>a;a++)l[a-1]=arguments[a];for(;i=e.shift();){if((c=n.all)&&(c=c.slice()),(o=n[i])&&(o=o.slice()),o)for(a=0,r=o.length;r>a;a+=2)o[a].apply(o[a+1]||this,l);if(c)for(s=[i].concat(l),a=0,r=c.length;r>a;a+=2)c[a].apply(c[a+1]||this,s)}return this},i.prototype.proxy=function(e){var t=this;return function(i){t.trigger(e,i)}},i.includeIn=function(e){e.on=i.prototype.on,e.off=i.prototype.off,e.trigger=i.prototype.trigger,e.proxy=i.prototype.proxy},i});